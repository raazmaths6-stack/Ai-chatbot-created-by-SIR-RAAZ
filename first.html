<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Chatbot - Created By SIR RAAZ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body, * { margin:0; padding:0; box-sizing:border-box; }
    .chat-message { animation: slideIn 0.3s ease-out; }
    @keyframes slideIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }
    .typing-indicator { display:inline-flex; gap:4px; }
    .typing-dot { width:8px; height:8px; border-radius:50%; background-color:#9CA3AF; animation: typing 1.4s infinite; }
    .typing-dot:nth-child(2) { animation-delay:0.2s; }
    .typing-dot:nth-child(3) { animation-delay:0.4s; }
    @keyframes typing { 0%,60%,100% { transform:translateY(0);} 30% { transform:translateY(-10px);} }
    .sidebar-transition { transition: transform 0.3s ease-in-out; }
    .scrollbar-thin::-webkit-scrollbar { width:6px; }
    .scrollbar-thin::-webkit-scrollbar-track { background:#1F2937; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background:#4B5563; border-radius:3px; }
    .scrollbar-thin::-webkit-scrollbar-thumb:hover { background:#6B7280; }
    .logo-placeholder { background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); display:flex; align-items:center; justify-content:center; font-size:24px; }
    .pulse { animation:pulse 2s cubic-bezier(0.4,0,0.6,1) infinite; }
    @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:.5;} }
  </style>
</head>
<body class="h-full">
<div id="app" class="h-full w-full flex overflow-hidden bg-gray-900">
  <!-- SIDEBAR -->
  <div id="sidebar" class="w-64 flex flex-col sidebar-transition bg-gray-800 border-r border-blue-600/20">
    <div class="p-4 border-b flex items-center gap-3 border-blue-600/20">
      <div id="logoContainer" class="logo-placeholder w-12 h-12 rounded-lg">ðŸ¤–</div>
      <div>
        <h2 id="sidebarTitle" class="font-bold text-lg text-gray-100">AI Chatbot</h2>
        <p id="sidebarCreator" class="text-xs text-gray-400">By SIR RAAZ</p>
      </div>
    </div>
    <div class="p-4">
      <button id="newChatBtn" class="w-full py-3 px-4 rounded-lg font-medium flex items-center justify-center gap-2 bg-blue-500 text-white">
        <span class="text-xl">âž•</span><span>New Chat</span>
      </button>
    </div>
    <div class="flex-1 overflow-y-auto scrollbar-thin px-2">
      <div class="text-xs font-semibold px-3 py-2 text-gray-400/60">CHAT HISTORY</div>
      <div id="chatHistory" class="space-y-1"></div>
    </div>
    <div class="p-4 border-t text-xs text-center border-blue-600/20 text-gray-400">
      <p>Powered by AI Technology</p>
      <p class="mt-1">Â© 2024 SIR RAAZ</p>
    </div>
  </div>

  <!-- MAIN CHAT AREA -->
  <div class="flex-1 flex flex-col">
    <div class="p-4 border-b flex items-center justify-between border-blue-600/20">
      <div class="flex items-center gap-3">
        <button id="menuBtn" class="p-2 rounded-lg hover:bg-gray-700 text-gray-100">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
        </button>
        <h1 id="mainTitle" class="text-xl font-bold text-gray-100">AI Chatbot Created By SIR RAAZ</h1>
      </div>
      <div class="flex items-center gap-2">
        <div id="statusIndicator" class="w-2 h-2 rounded-full bg-green-500"></div>
        <span id="statusText" class="text-sm font-medium text-gray-100">Ready</span>
      </div>
    </div>

    <div id="messagesContainer" class="flex-1 overflow-y-auto p-6 scrollbar-thin">
      <div id="messages" class="max-w-4xl mx-auto space-y-4 text-gray-400 text-center py-12">
        <div class="text-6xl mb-4">ðŸ’¬</div>
        <p class="text-lg">Start a conversation with AI</p>
        <p class="text-sm mt-2">Type a message below to begin</p>
      </div>
    </div>

    <div class="border-t p-4 border-blue-600/20">
      <form id="chatForm" class="max-w-4xl mx-auto">
        <div class="flex gap-3">
          <input type="text" id="messageInput" placeholder="Type your message here..." class="flex-1 px-4 py-3 rounded-lg border-2 focus:outline-none bg-gray-800 text-gray-100 border-blue-400/40" autocomplete="off" required>
          <button type="submit" id="sendBtn" class="px-6 py-3 rounded-lg font-medium flex items-center gap-2 bg-blue-500 text-white hover:opacity-90">
            <span>Send</span><span class="text-xl">ðŸ“¤</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
const CONFIG = {
  BACKEND_URL: 'http://localhost:3000', // Backend URL
  API_ENDPOINT: '/api/chat',
  colors: {
    chatbot_title: 'AI Chatbot',
    creator_name: 'SIR RAAZ',
    primary_color: '#3B82F6',
    secondary_color: '#1F2937',
    background_color: '#111827',
    text_color: '#F9FAFB',
    accent_color: '#10B981'
  }
};

let chatSessions = [];
let currentSessionId = null;
let isSidebarOpen = true;

// =====================
// UI & Session Functions
// =====================
function createNewSession() {
  const sessionId = Date.now().toString();
  chatSessions.unshift({ id: sessionId, title:'New Chat', messages:[], createdAt:new Date() });
  currentSessionId = sessionId;
  renderMessages();
  renderChatHistory();
  document.getElementById('messageInput').focus();
}

function getCurrentSession() { return chatSessions.find(s=>s.id===currentSessionId); }

function renderMessages() {
  const messagesDiv = document.getElementById('messages');
  const session = getCurrentSession();
  if(!session || session.messages.length===0){
    messagesDiv.innerHTML = `<div class="text-center py-12 text-gray-400"><div class="text-6xl mb-4">ðŸ’¬</div><p class="text-lg">Start a conversation with AI</p><p class="text-sm mt-2">Type a message below to begin</p></div>`;
    return;
  }
  messagesDiv.innerHTML = session.messages.map(msg=>{
    const isUser = msg.role==='user';
    const bgColor = isUser? CONFIG.colors.primary_color: CONFIG.colors.secondary_color;
    const alignment = isUser? 'ml-auto':'mr-auto';
    return `<div class="chat-message ${alignment} max-w-2xl px-4 py-3 rounded-lg" style="background-color:${bgColor};color:${CONFIG.colors.text_color};">
      <div class="flex items-start gap-3"><div class="text-2xl">${isUser?'ðŸ‘¤':'ðŸ¤–'}</div><div class="flex-1"><div class="font-medium mb-1">${isUser?'You':'AI Assistant'}</div><div class="text-sm opacity-90 whitespace-pre-wrap">${escapeHtml(msg.content)}</div></div></div></div>`;
  }).join('');
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

function renderChatHistory() {
  const historyDiv = document.getElementById('chatHistory');
  historyDiv.innerHTML = chatSessions.map(session=>{
    const isActive = session.id===currentSessionId;
    const bgColor = isActive? CONFIG.colors.primary_color+'20':'transparent';
    return `<button class="history-item w-full text-left px-3 py-2 rounded-lg transition-all hover:bg-opacity-50" style="color:${CONFIG.colors.text_color};background-color:${bgColor}" data-session-id="${session.id}">
      <div class="font-medium truncate">${escapeHtml(session.title)}</div>
      <div class="text-xs opacity-60">${new Date(session.createdAt).toLocaleDateString()}</div>
    </button>`;
  }).join('');
  document.querySelectorAll('.history-item').forEach(btn=>btn.addEventListener('click',()=>{
    currentSessionId = btn.dataset.sessionId;
    renderMessages();
    renderChatHistory();
  }));
}

function escapeHtml(text){ const div=document.createElement('div'); div.textContent=text; return div.innerHTML; }

// =====================
// Backend API Call
// =====================
async function sendMessageToBackend(message){
  try {
    const url = `${CONFIG.BACKEND_URL}${CONFIG.API_ENDPOINT}`;
    const response = await fetch(url, {
      method:'POST',
      headers:{ 'Content-Type':'application/json' },
      body: JSON.stringify({ message })
    });
    if(!response.ok) throw new Error(`HTTP ${response.status}`);
    const data = await response.json();
    return data.reply;
  } catch(err){
    console.error(err);
    return 'âš ï¸ Backend error. Try again later.';
  }
}

// =====================
// Event Handlers
// =====================
document.getElementById('chatForm').addEventListener('submit', async e=>{
  e.preventDefault();
  const input = document.getElementById('messageInput');
  const message = input.value.trim();
  if(!message) return;
  if(!currentSessionId) createNewSession();
  const session = getCurrentSession();
  session.messages.push({role:'user', content:message});
  renderMessages();
  input.value='';

  const botReply = await sendMessageToBackend(message);
  session.messages.push({role:'assistant', content:botReply});
  renderMessages();
});

document.getElementById('newChatBtn').addEventListener('click',()=>createNewSession());
document.getElementById('menuBtn').addEventListener('click', ()=>{
  isSidebarOpen = !isSidebarOpen;
  document.getElementById('sidebar').style.transform = isSidebarOpen?'translateX(0)':'translateX(-100%)';
});

// =====================
// Initialization
// =====================
createNewSession();
</script>
</body>
</html>
